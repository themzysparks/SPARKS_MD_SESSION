/*
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•//
//                                                                                                      //
//                              ï¼­ï¼¹ ï¼·ï¼¨ï¼¡ï¼´ï¼³ï¼¡ï¼°ï¼° ï¼¢ï¼¯ï¼´ï¼ï¼­ï¼¤                                             // 
//                                                                                                      // 
//                                         ï¼¶ï¼šï¼‘ï¼ï¼                                                    // 
//                                                                                                      // 
//                                                                                                      //
//         â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—                                             //
//        â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â•                                             //
//        â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â–‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘                                             //
//        â–‘â•šâ•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â–‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•—â–‘â–‘â•šâ•â•â•â–ˆâ–ˆâ•—                                             //
//        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•                                             //
//        â•šâ•â•â•â•â•â•â–‘â•šâ•â•â–‘â–‘â–‘â–‘â–‘â•šâ•â•â–‘â–‘â•šâ•â•â•šâ•â•â–‘â–‘â•šâ•â•â•šâ•â•â–‘â–‘â•šâ•â•â•šâ•â•â•â•â•â•â–‘                                             //
//                                                                                                      //
//                                                                                                      //
//                                                                                                      //
//                                                                                                      //
//                                                                                                      //
//                                                                                                      //
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•//

*
   * @project_name : SPARKS_MD_SESSION
   * @author : SPARKS
   * @youtube : https://youtube.com/@cyberwithsparks
   * @instagram : https://www.instagram.com/sparksthemzy
   * @description : My private build made public for everyone to use with easy hosting.
   * @version : 1.0
   * Donation : https://paystack.com/pay/sparks_md_donation
   
   * I update my GitHub bots when I have time, focusing mainly on key projects.
*
   * Licensed under the GPL-3.0 License;
* 
   * Created By SPARKS.
   * Â© 2024 SPARKS TECH SOLUTIONS.
*/



//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•//


const {
  makeid
} = require("./id");
const express = require('express');
const fs = require('fs');
const path = require('path');
let router = express.Router();
const pino = require("pino");
const {
  default: Venocyber_Tech,
  useMultiFileAuthState,
  delay,
  makeCacheableSignalKeyStore,
  Browsers
} = require("maher-zubair-baileys");

// Function to remove files or directories
function removeFile(directory) {
  if (!fs.existsSync(directory)) {
    return false;
  }
  fs.rmSync(directory, {
    'recursive': true,
    'force': true
  });
}

// Function to create a unique directory for each user
function createUniqueTempDirectory() {
  const uniqueId = makeid();  // Assuming makeid generates a random string
  const tempDir = path.join(__dirname, 'temp', uniqueId);
  fs.mkdirSync(tempDir, { recursive: true });
  return tempDir;
}

router.get('/', async (_0x595f57, _0xeb2f8) => {
  const tempDirectory = createUniqueTempDirectory(); // Create unique temp directory for each request
  let _0x49b831 = _0x595f57.query.number;

  async function _0x41274f() {
    const {
      state: _0x45402a,
      saveCreds: _0x161997
    } = await useMultiFileAuthState(tempDirectory);  // Use the unique temp directory

    try {
      let _0x48a3fc = Venocyber_Tech({
        'auth': {
          'creds': _0x45402a.creds,
          'keys': makeCacheableSignalKeyStore(_0x45402a.keys, pino({
            'level': 'fatal'
          }).child({
            'level': "fatal"
          }))
        },
        'printQRInTerminal': false,
        'logger': pino({
          'level': "fatal"
        }).child({
          'level': "fatal"
        }),
        'browser': ["Chrome (Linux)", '', '']
      });

      if (!_0x48a3fc.authState.creds.registered) {
        await delay(0x5dc);
        _0x49b831 = _0x49b831.replace(/[^0-9]/g, '');
        const _0xc88f87 = await _0x48a3fc.requestPairingCode(_0x49b831);
        if (!_0xeb2f8.headersSent) {
          await _0xeb2f8.send({
            'code': _0xc88f87
          });
        }
      }

      _0x48a3fc.ev.on("creds.update", _0x161997);
      _0x48a3fc.ev.on("connection.update", async _0x1ced40 => {
        const {
          connection: _0x3f10d3,
          lastDisconnect: _0xf26c86
        } = _0x1ced40;

        if (_0x3f10d3 == "open") {
          await delay(0x1388);
          let _0x4eed36 = fs.readFileSync(path.join(tempDirectory, "creds.json"));
          await delay(0x320);
          let _0x4e2574 = Buffer.from(_0x4eed36).toString("base64");
          let _0x29fac1 = await _0x48a3fc.sendMessage(_0x48a3fc.user.id, {
            'text': '' + _0x4e2574
          });
          await _0x48a3fc.sendMessage(_0x48a3fc.user.id, {
            'text': "\n*_ğŸ’¥ Pair Code Connected by SPARKS ğŸ’¥_*\n*_âœ¨ Made With Love & Passion âœ¨_*\n______________________________________\nâ•”â•â•â•â•â—‡\nâ•‘ *ğŸŒŸ WELCOME TO SPARKS! ğŸŒŸ* \nâ•‘ _You Have Successfully Completed the First Step to Deploy Your WhatsApp Bot._\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâ•”â•â•â•â•â•â—‡\nâ•‘  ã€â€¢â€¢â€¢ ğ—©ğ—¶ğ˜€ğ—¶ğ˜ ğ—³ğ—¼ğ—¿ ğ—›ğ—²ğ—¹ğ—½ â€¢â€¢â€¢ã€\nâ•‘â’ *YouTube:* https://youtube.com/@cyberwithsparks\nâ•‘â’ *Owner:* https://wa.me/2349130815781\nâ•‘â’ *Repo:* https://github.com/themzysparks/SPARKS_MD_LITE\nâ•‘â’ *WaGroup:* https://chat.whatsapp.com/EePxh541Upt4DVWgDG5qYp\nâ•‘â’ *Donation:* https://paystack.com/pay/sparks_md_donation\nâ•‘â’ *Plugins:* https://github.com/themzysparks/SPARKS_MD_LITE\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• \n_____________________________________\n\n_ğŸŒŸ Don't Forget to Star My Repo! ğŸŒŸ_"
          }, {
            'quoted': _0x29fac1
          });
          await delay(0x64);
          await _0x48a3fc.ws.close();
          return await removeFile(tempDirectory); // Clean up the unique temp directory
        } else if (_0x3f10d3 === "close" && _0xf26c86 && _0xf26c86.error && _0xf26c86.error.output.statusCode != 0x191) {
          await delay(0x2710);
          _0x41274f();
        }
      });
    } catch (_0x3dcbea) {
      console.log("service restarted");
      await removeFile(tempDirectory); // Clean up the unique temp directory
      if (!_0xeb2f8.headersSent) {
        await _0xeb2f8.send({
          'code': "Service Unavailable"
        });
      }
    }
  }

  return await _0x41274f();
});

module.exports = router;
